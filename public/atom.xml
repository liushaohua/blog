<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title><![CDATA[厘澄的小站-专注前端开发]]></title>
  <subtitle><![CDATA[厘澄的小站-专注前端开发]]></subtitle>
  <link href="/atom.xml" rel="self"/>
  <link href="http://www.liushaohua.cn/"/>
  <updated>2016-03-08T02:00:01.627Z</updated>
  <id>http://www.liushaohua.cn/</id>
  
  <author>
    <name><![CDATA[厘澄]]></name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title><![CDATA[晒晒我家的动感喵星人]]></title>
    <link href="http://www.liushaohua.cn/2016/02/29/cat/"/>
    <id>http://www.liushaohua.cn/2016/02/29/cat/</id>
    <published>2016-02-29T05:46:08.000Z</published>
    <updated>2016-03-08T02:00:01.627Z</updated>
    <content type="html"><![CDATA[<p>14年8月，我家迎来了一个新成员[弥撒]，一只活泼的喵星人，现在陪伴了俺们一年半有余了，给我们的生活增加了很多乐趣，晒一晒~~<br><a id="more"></a></p>
<p><img src="https://o3o97s3zl.qnssl.com/misa1.jpg" alt="弥撒01"><br><img src="https://o3o97s3zl.qnssl.com/misa2.jpg" alt="弥撒02"><br><img src="https://o3o97s3zl.qnssl.com/misa3.jpg" alt="弥撒03"><br><img src="https://o3o97s3zl.qnssl.com/misa4.jpg" alt="弥撒04"><br><img src="https://o3o97s3zl.qnssl.com/misa5.jpg" alt="弥撒05"><br><img src="https://o3o97s3zl.qnssl.com/misa6.jpg" alt="弥撒06"><br><img src="https://o3o97s3zl.qnssl.com/misa7.jpg" alt="弥撒07"><br><img src="https://o3o97s3zl.qnssl.com/misa8.jpg" alt="弥撒08"><br><img src="https://o3o97s3zl.qnssl.com/misa9.jpg" alt="弥撒09"><br><img src="https://o3o97s3zl.qnssl.com/misa10.jpg" alt="弥撒10"><br><img src="https://o3o97s3zl.qnssl.com/misa11.jpg" alt="弥撒11"><br><img src="https://o3o97s3zl.qnssl.com/misa12.jpg" alt="弥撒12"><br><img src="https://o3o97s3zl.qnssl.com/misa13.jpg" alt="弥撒13"></p>
<h3 id="u7ED3_u8BED_uFF1A_u5C31_u662F_u8FD9_u4E48_u9738_u6C14_uFF01"><a href="#u7ED3_u8BED_uFF1A_u5C31_u662F_u8FD9_u4E48_u9738_u6C14_uFF01" class="headerlink" title="结语：就是这么霸气！"></a>结语：就是这么霸气！</h3>]]></content>
    <summary type="html">
    <![CDATA[<p>14年8月，我家迎来了一个新成员[弥撒]，一只活泼的喵星人，现在陪伴了俺们一年半有余了，给我们的生活增加了很多乐趣，晒一晒~~<br>]]>
    
    </summary>
    
      <category term="个人随笔" scheme="http://www.liushaohua.cn/tags/%E4%B8%AA%E4%BA%BA%E9%9A%8F%E7%AC%94/"/>
    
      <category term="喵星人" scheme="http://www.liushaohua.cn/tags/%E5%96%B5%E6%98%9F%E4%BA%BA/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[纪念我的2015年终总结]]></title>
    <link href="http://www.liushaohua.cn/2016/01/31/%E7%BA%AA%E5%BF%B5%E6%88%91%E7%9A%842015%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/"/>
    <id>http://www.liushaohua.cn/2016/01/31/纪念我的2015年终总结/</id>
    <published>2016-01-31T03:48:31.000Z</published>
    <updated>2016-01-31T04:46:23.931Z</updated>
    <content type="html"><![CDATA[<p>关于<code>年终总结</code>这回事，我决的还是有<code>必要的</code>，虽然不是那么值得<code>几年</code>,但2015对我来说也是不<code>平凡</code>的一年，时间过得似乎是忽快忽慢，让人措手不及，简单的记录下，激励下自己。<br><a id="more"></a></p>
<h3 id="1_u6708"><a href="#1_u6708" class="headerlink" title="1月"></a>1月</h3><p>1月貌似是没发生什么大事，当时我还住在<code>永泰庄</code>的自如小单间里，生活平淡工作开心</p>
<h3 id="2_u6708"><a href="#2_u6708" class="headerlink" title="2月"></a>2月</h3><p>2月给人的印象是<code>过年月</code>，沉浸在年前、年中<code>鸡血不足</code>的状态</p>
<h3 id="3_u6708"><a href="#3_u6708" class="headerlink" title="3月"></a>3月</h3><p>年后，离开了自己工作近1年半的地方，可能不到1年半，1年零2 3个月？来到了一家<code>创业</code>型公司，开启了一段新的旅程</p>
<h3 id="4_u6708"><a href="#4_u6708" class="headerlink" title="4月"></a>4月</h3><p>4月似乎是自如租的房子到期了，搬到旁边不到100米的另外一个小两居的房子里（忘记是3月还是4月了），房子不大，不到60平，<code>3800</code>，厕所卫生间条件就略差了，一分钱一分价，工作也算正常，创业公司大部分都是加班会多一点，一般不会超过9点，同事关系还不错，不忙的时候还可以学习下，<code>node</code>和<code>mogo</code>都有提高。</p>
<h3 id="5_u30016_u6708"><a href="#5_u30016_u6708" class="headerlink" title="5、6月"></a>5、6月</h3><p>具体记不清楚了，不知哪天上班的时候碰到一只小黑猫，带回了家，俺家也迎来了第二只小猫子，工作上发生一点小插曲，公司扩招的同时，开始有部分技术领导相继离职，后端也开始由PHP转向JAVA，<code>前端</code>还是比较稳定，还是不受重视~~ haha，和领导也有过相关沟通，不管孰是孰非，最终还是申请离职了，<code>6.23</code>号入职现公司。</p>
<h3 id="7_u30018_u30019_u300110_u6708"><a href="#7_u30018_u30019_u300110_u6708" class="headerlink" title="7、8、9、10月"></a>7、8、9、10月</h3><p>已经适应现在的工作，住的地方又由永泰庄搬到了望京，上班骑自行车的话20分钟</p>
<h3 id="11_u300112_u30011_u6708"><a href="#11_u300112_u30011_u6708" class="headerlink" title="11、12、1月"></a>11、12、1月</h3><p>转眼年底，部门的前端团队日益壮大，由之前的1个人变成了现在的7个人，工作流程步入正轨，团队里的同事们比较和谐，团队能力再一点点提高，由之前的PC慢慢的涉及到微信，混合应用，同事领导对我也算认可，自身有待提高的地方还很多，15年的技术成长还算缓慢，16年要加快步伐了，不然就掉队了， - -!又搬家了，搬到了<code>京旺家园</code>，《芈月传》<code>陪</code>女友看完了，收获良多</p>
<h3 id="u603B_u7ED3"><a href="#u603B_u7ED3" class="headerlink" title="总结"></a>总结</h3><p>15年对我来说算个沉淀，<code>芈月</code>中说的好<code>有多少付出，就有多少回报</code>,16年要把欠大家和欠自己的补回来，<code>努力工作和学习</code> - 自勉。</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>关于<code>年终总结</code>这回事，我决的还是有<code>必要的</code>，虽然不是那么值得<code>几年</code>,但2015对我来说也是不<code>平凡</code>的一年，时间过得似乎是忽快忽慢，让人措手不及，简单的记录下，激励下自己。<br>]]>
    
    </summary>
    
      <category term="年终总结" scheme="http://www.liushaohua.cn/tags/%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[ECMAScript学习笔记]]></title>
    <link href="http://www.liushaohua.cn/2016/01/26/ECMAScript%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    <id>http://www.liushaohua.cn/2016/01/26/ECMAScript学习笔记/</id>
    <published>2016-01-26T06:13:51.000Z</published>
    <updated>2016-02-01T07:46:08.894Z</updated>
    <content type="html"><![CDATA[<p>ECMAScript做前端的同学都不会陌生，去年中Ecma国际大会宣布正式批准ECMA-262第6版，亦即ECMAScript 2015（曾用名：ECMAScript 6、ES6）的语言规范。ES6对于ES5是进行了相当大的改进，增加了许许多多的新特性，使得JavaScript<code>看上去</code>不再那么<code>渣</code>，目前还没有一款支持全部ES6新特性的的服务代理(浏览器+服务器端)，目前我们能做到的就是把ES6代码转译成ES5的代码，小道消息说主流浏览器完全实现ES6特性大概需要一年左右时间，毕竟不是官方发出的，要是2年没支持，咱也没办法不是。</p>
<a id="more"></a>
<p>由简入深，实践运用下</p>
<h3 id="let_const_u547D_u4EE4"><a href="#let_const_u547D_u4EE4" class="headerlink" title="let const命令"></a>let const命令</h3><ul>
<li><code>let</code>类此于<code>var</code>，用来声明<code>块级作用域</code>变量，并且不允许重复声明</li>
<li><code>const</code>是用来定义常量，何为常量？<code>一棵树上吊死</code>，也不允许重复声明</li>
</ul>
<p><strong>let代码事例:</strong><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;&#125;</span><br><span class="line"><span class="comment">//i = 10 for和function不同，for中变量的作用域是上一级function或者全局，而function中变量的作用域是function内部，所以for循环后，i是继续存在的。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a = [];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">  a[i] = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(i);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line">a[<span class="number">2</span>](); <span class="comment">// 2</span></span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">       <span class="keyword">let</span> a = <span class="number">123</span>;</span><br><span class="line">       <span class="comment">//a 123</span></span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">//a 报错</span></span><br></pre></td></tr></table></figure></p>
<p><strong>const代码事例:</strong><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> WIDTH = <span class="number">45</span>;</span><br><span class="line">WIDTH = <span class="number">50</span>；</span><br><span class="line"><span class="comment">//WIDTH 45</span></span><br></pre></td></tr></table></figure></p>
<h3 id="async_await"><a href="#async_await" class="headerlink" title="async await"></a>async await</h3><ul>
<li>关于<code>异步编程</code>，有多种方法，利弊就不多说了<ul>
<li>callback</li>
<li>事件监听</li>
<li>观察者</li>
<li>Promise</li>
</ul>
</li>
<li>ES6/7提供了终极的解决方案<code>async await</code></li>
<li>有些特性必须要借助<code>polyfill/runtime</code>才能使用</li>
<li><code>并行处理</code> - 使用 <code>async/await</code> 来处理异步时，是串行执行的。但很多场景下我们需要并行处理，这样可以大大提高执行效率，此时可以结合 Promise.all 来处理。</li>
</ul>
<p><strong>async await代码事例:</strong><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> asyncReadFile = <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">let</span> f1 = <span class="keyword">await</span> readFile(path.normalize(__dirname + <span class="string">'/003.js'</span>));</span><br><span class="line">  <span class="keyword">let</span> f2 = <span class="keyword">await</span> readFile(path.normalize(__dirname + <span class="string">'/003.js'</span>));</span><br><span class="line">  <span class="built_in">console</span>.log(f1.toString());</span><br><span class="line">  <span class="built_in">console</span>.log(f2.toString());</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> result = asyncReadFile();</span><br><span class="line"></span><br><span class="line"><span class="comment">//并行处理</span></span><br><span class="line"><span class="keyword">async</span> indexAction()&#123;</span><br><span class="line">    <span class="keyword">let</span> p1 = <span class="keyword">this</span>.getServiceData1();</span><br><span class="line">    <span class="keyword">let</span> p2 = <span class="keyword">this</span>.getAPIData2();</span><br><span class="line">    <span class="keyword">let</span> [p1Data, p2Data] = <span class="keyword">await</span> <span class="built_in">Promise</span>.all([p1, p2]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="export_import"><a href="#export_import" class="headerlink" title="export import"></a>export import</h3><ul>
<li>模块之间的相互调用关系是通过 export 来规定模块对外暴露的接口，通过import来引用其它模块提供的接口。同时还为模块创造了命名空间，防止函数的命名冲突</li>
<li>定义好模块的输出以后就可以在另外一个模块通过import引用</li>
</ul>
<p><strong>export代码事例:</strong><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">//test.js</span></span><br><span class="line"> <span class="keyword">var</span> name = <span class="string">'Rainbow'</span>;</span><br><span class="line"> <span class="keyword">var</span> age = <span class="string">'24'</span>;</span><br><span class="line"> <span class="keyword">export</span> &#123;name, age&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//test.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getName</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"> <span class="keyword">return</span> name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getAge</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">return</span> age;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//test.js default 导出</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">getAge</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 或者写成</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getAge</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> getAge;</span><br></pre></td></tr></table></figure></p>
<p><strong>import代码事例:</strong><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//index.js</span></span><br><span class="line"><span class="keyword">import</span> &#123;name, age&#125; <span class="keyword">from</span> <span class="string">'./test.js'</span></span><br><span class="line"></span><br><span class="line">//index.js</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> test form <span class="string">'./test.js'</span>;  <span class="comment">//import * as 就完成了模块整体的导入</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//index.js</span></span><br><span class="line"><span class="comment">// 导入的时候不需要花括号</span></span><br><span class="line"><span class="keyword">import</span> test <span class="keyword">from</span> <span class="string">'./test.js'</span>;</span><br></pre></td></tr></table></figure></p>
<h3 id="class"><a href="#class" class="headerlink" title="class"></a>class</h3><ul>
<li>Class之间可以通过extends关键字，实现继承，这比ES5的通过修改原型链实现继承，要清晰和方便很多</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ColorPoint</span> <span class="keyword">extends</span> <span class="title">Point</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  constructor(x, y, color) &#123;</span><br><span class="line">    <span class="keyword">super</span>(x, y); <span class="comment">// 等同于parent.constructor(x, y)</span></span><br><span class="line">    <span class="keyword">this</span>.color = color;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  toString() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.color + <span class="string">' '</span> + <span class="keyword">super</span>.toString(); <span class="comment">// 等同于parent.toString()</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    <summary type="html">
    <![CDATA[<p>ECMAScript做前端的同学都不会陌生，去年中Ecma国际大会宣布正式批准ECMA-262第6版，亦即ECMAScript 2015（曾用名：ECMAScript 6、ES6）的语言规范。ES6对于ES5是进行了相当大的改进，增加了许许多多的新特性，使得JavaScript<code>看上去</code>不再那么<code>渣</code>，目前还没有一款支持全部ES6新特性的的服务代理(浏览器+服务器端)，目前我们能做到的就是把ES6代码转译成ES5的代码，小道消息说主流浏览器完全实现ES6特性大概需要一年左右时间，毕竟不是官方发出的，要是2年没支持，咱也没办法不是。</p>]]>
    
    </summary>
    
      <category term="ECMAScript" scheme="http://www.liushaohua.cn/tags/ECMAScript/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[使用ThinkJS构建web应用]]></title>
    <link href="http://www.liushaohua.cn/2015/12/01/thinkjs/"/>
    <id>http://www.liushaohua.cn/2015/12/01/thinkjs/</id>
    <published>2015-12-01T09:09:58.000Z</published>
    <updated>2016-03-11T07:57:55.552Z</updated>
    <content type="html"><![CDATA[<p>玩过<code>Node</code>的同学对<code>Express</code>肯定不陌生，是TJ大神主刀开发的，今天咱们来说<code>下ThinkJS</code>，提到<code>ThinkPHP</code>各位同学肯定秒懂了，感谢<code>奇舞团</code>&amp;&amp;<code>成银老师</code>。</p>
<a id="more"></a>
<p>ThinkJS基于<code>MVC</code>设计，把数据视图表现分离得当，把常用的Node方法进行了封装，入门简单，大大的提高了开发效率，让我们可以随随便便分分钟构建一个web应用，废话不多说，直接来。</p>
<h3 id="u5B89_u88C5ThinkJS"><a href="#u5B89_u88C5ThinkJS" class="headerlink" title="安装ThinkJS"></a>安装ThinkJS</h3><ul>
<li>npm install thinkjs@2 -g –verbos</li>
</ul>
<h3 id="u521B_u5EFA_u9879_u76EE_26amp_3B_26amp_3B_u542F_u52A8"><a href="#u521B_u5EFA_u9879_u76EE_26amp_3B_26amp_3B_u542F_u52A8" class="headerlink" title="创建项目&amp;&amp;启动"></a>创建项目&amp;&amp;启动</h3><ul>
<li>thinkjs new project_path –es6</li>
<li>cd project_path &amp;&amp; npm install</li>
<li>npm start</li>
</ul>
<h3 id="u76EE_u5F55_u7ED3_u6784"><a href="#u76EE_u5F55_u7ED3_u6784" class="headerlink" title="目录结构"></a>目录结构</h3><p><img src="https://o3o97s3zl.qnssl.com/20151201_route.png" alt="目录结构"></p>
<ul>
<li>src 查看当前所有模块<ul>
<li>bootstrap</li>
<li>config</li>
<li>controller</li>
</ul>
</li>
<li>view 视图文件</li>
</ul>
<h3 id="common_-_26gt_3B_config_-_26gt_3B_config-js__u4FEE_u6539config"><a href="#common_-_26gt_3B_config_-_26gt_3B_config-js__u4FEE_u6539config" class="headerlink" title="common -&gt; config -&gt; config.js 修改config"></a>common -&gt; config -&gt; config.js 修改config</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  route_on: <span class="literal">true</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="u5F00_u542F_u9ED8_u8BA4_u8DEF_u7531_uFF0C_u5728config_u76EE_u5F55_u4E0B_u521B_u5EFA_router-js"><a href="#u5F00_u542F_u9ED8_u8BA4_u8DEF_u7531_uFF0C_u5728config_u76EE_u5F55_u4E0B_u521B_u5EFA_router-js" class="headerlink" title="开启默认路由，在config目录下创建 router.js"></a>开启默认路由，在config目录下创建 router.js</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//自定义路由规则</span></span><br><span class="line"><span class="built_in">module</span>.exports = [</span><br><span class="line">	[<span class="string">"page/:id"</span>, <span class="string">"index/page"</span>],					<span class="comment">//详情页</span></span><br><span class="line">	[<span class="string">"archives"</span>,<span class="string">"index/archives"</span>],				<span class="comment">//归档</span></span><br><span class="line">	[<span class="string">"error"</span>,<span class="string">"index/error"</span>]						<span class="comment">//错误</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h3 id="u4FEE_u6539_u9875_u9762"><a href="#u4FEE_u6539_u9875_u9762" class="headerlink" title="修改页面"></a>修改页面</h3><ul>
<li>进入 view -&gt; home -&gt; index_index.html<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">id</span>=<span class="value">"msgBox"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">form</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="title">h2</span>&gt;</span>来 , 说说你在做什么 , 想什么<span class="tag">&lt;/<span class="title">h2</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="title">div</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="title">input</span> <span class="attribute">id</span>=<span class="value">"userName"</span> <span class="attribute">class</span>=<span class="value">"f-text"</span> <span class="attribute">value</span>=<span class="value">""</span> /&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="title">p</span> <span class="attribute">id</span>=<span class="value">"face"</span>&gt;</span><span class="tag">&lt;<span class="title">img</span> <span class="attribute">src</span>=<span class="value">"/static/img/face1.gif"</span> <span class="attribute">class</span>=<span class="value">"current"</span> /&gt;</span><span class="tag">&lt;<span class="title">img</span> <span class="attribute">src</span>=<span class="value">"/static/img/face2.gif"</span> /&gt;</span><span class="tag">&lt;<span class="title">img</span> <span class="attribute">src</span>=<span class="value">"/static/img/face3.gif"</span> /&gt;</span><span class="tag">&lt;<span class="title">img</span> <span class="attribute">src</span>=<span class="value">"/static/img/face4.gif"</span> /&gt;</span><span class="tag">&lt;<span class="title">img</span> <span class="attribute">src</span>=<span class="value">"/static/img/face5.gif"</span> /&gt;</span><span class="tag">&lt;<span class="title">img</span> <span class="attribute">src</span>=<span class="value">"/static/img/face6.gif"</span> /&gt;</span><span class="tag">&lt;<span class="title">img</span> <span class="attribute">src</span>=<span class="value">"/static/img/face7.gif"</span> /&gt;</span><span class="tag">&lt;<span class="title">img</span> <span class="attribute">src</span>=<span class="value">"/static/img/face8.gif"</span> /&gt;</span><span class="tag">&lt;/<span class="title">p</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="title">div</span>&gt;</span><span class="tag">&lt;<span class="title">textarea</span> <span class="attribute">id</span>=<span class="value">"conBox"</span> <span class="attribute">class</span>=<span class="value">"f-text"</span>&gt;</span><span class="tag">&lt;/<span class="title">textarea</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"tr"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="title">p</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="title">span</span> <span class="attribute">class</span>=<span class="value">"countTxt"</span>&gt;</span>还能输入<span class="tag">&lt;/<span class="title">span</span>&gt;</span><span class="tag">&lt;<span class="title">strong</span> <span class="attribute">class</span>=<span class="value">"maxNum"</span>&gt;</span>140<span class="tag">&lt;/<span class="title">strong</span>&gt;</span><span class="tag">&lt;<span class="title">span</span>&gt;</span>个字<span class="tag">&lt;/<span class="title">span</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="title">input</span> <span class="attribute">id</span>=<span class="value">"sendBtn"</span> <span class="attribute">type</span>=<span class="value">"button"</span> <span class="attribute">value</span>=<span class="value">""</span> <span class="attribute">title</span>=<span class="value">"快捷键 Ctrl+Enter"</span> /&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="title">p</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="title">form</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"list"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="title">h3</span>&gt;</span><span class="tag">&lt;<span class="title">span</span>&gt;</span>大家在说<span class="tag">&lt;/<span class="title">span</span>&gt;</span><span class="tag">&lt;/<span class="title">h3</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="title">ul</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="title">%data.forEach(function(v)&#123;%</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="title">li</span> <span class="attribute">list_id</span>=<span class="value">"&lt;%=v.id%&gt;"</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"userPic"</span>&gt;</span><span class="tag">&lt;<span class="title">img</span> <span class="attribute">src</span>=<span class="value">"/static/img/face&lt;%=v.user_id%&gt;.gif"</span> /&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"content"</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"userName"</span>&gt;</span><span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"javascript:;"</span>&gt;</span><span class="tag">&lt;<span class="title">%=v.user_name%</span>&gt;</span><span class="tag">&lt;/<span class="title">a</span>&gt;</span>:<span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"msgInfo"</span>&gt;</span><span class="tag">&lt;<span class="title">%=v.text%</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"times"</span>&gt;</span><span class="tag">&lt;<span class="title">span</span>&gt;</span><span class="tag">&lt;<span class="title">%=v.date%</span>&gt;</span><span class="tag">&lt;/<span class="title">span</span>&gt;</span><span class="tag">&lt;<span class="title">a</span> <span class="attribute">class</span>=<span class="value">"del"</span> <span class="attribute">href</span>=<span class="value">"javascript:;"</span>&gt;</span>删除<span class="tag">&lt;/<span class="title">a</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="title">li</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="title">%&#125;)%</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="title">ul</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="title">div</span>&gt;</span>	</span><br><span class="line"><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="u589E_u52A0_u63A7_u5236_u5668"><a href="#u589E_u52A0_u63A7_u5236_u5668" class="headerlink" title="增加控制器"></a>增加控制器</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="keyword">extends</span> <span class="title">Base</span> </span>&#123;</span><br><span class="line">  <span class="comment">/**</span><br><span class="line">   * index action</span><br><span class="line">   * 首页控制器</span><br><span class="line">   * @return &#123;Promise&#125; []</span><br><span class="line">   */</span></span><br><span class="line">  <span class="keyword">async</span> indexAction()&#123;</span><br><span class="line">	<span class="keyword">let</span> data = <span class="keyword">await</span> <span class="keyword">this</span>.model(<span class="string">'list'</span>).getList();</span><br><span class="line">	<span class="keyword">this</span>.assign(<span class="string">'data'</span>, data);</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">this</span>.display();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">/**</span><br><span class="line">   * send action</span><br><span class="line">   * 发送消息</span><br><span class="line">   * @return &#123;Promise&#125; []</span><br><span class="line">   */</span></span><br><span class="line">  <span class="keyword">async</span> sendAction() &#123;</span><br><span class="line">	  <span class="keyword">if</span>(<span class="keyword">this</span>.isPost())&#123;</span><br><span class="line">		  <span class="keyword">await</span> <span class="keyword">this</span>.model(<span class="string">'list'</span>).addList(<span class="keyword">this</span>.post());</span><br><span class="line">		  <span class="keyword">this</span>.success();</span><br><span class="line">	  &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">/**</span><br><span class="line">   * send action</span><br><span class="line">   * 删除消息</span><br><span class="line">   * @return &#123;Promise&#125; []</span><br><span class="line">   */</span></span><br><span class="line">  <span class="keyword">async</span> deleteAction() &#123;</span><br><span class="line">	  <span class="keyword">if</span> (<span class="keyword">this</span>.isAjax()) &#123;</span><br><span class="line">		  <span class="keyword">await</span> <span class="keyword">this</span>.model(<span class="string">'list'</span>).delete_list(<span class="keyword">this</span>.post(<span class="string">'id'</span>));	</span><br><span class="line">		  <span class="keyword">this</span>.success();</span><br><span class="line">	  &#125;</span><br><span class="line">  &#125;	  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="u589E_u52A0model"><a href="#u589E_u52A0model" class="headerlink" title="增加model"></a>增加model</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> * model</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="keyword">extends</span> <span class="title">think</span>.<span class="title">model</span>.<span class="title">base</span> </span>&#123;</span><br><span class="line">	<span class="keyword">async</span> getList() &#123;</span><br><span class="line">		<span class="keyword">let</span> data = <span class="keyword">await</span> <span class="keyword">this</span>.field(<span class="string">"id,user_id,user_name,text,date"</span>).order(<span class="string">'id DESC'</span>).select();</span><br><span class="line">		<span class="keyword">return</span> data;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">async</span> addList(d) &#123;</span><br><span class="line">		<span class="keyword">await</span> <span class="keyword">this</span>.add(d);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">async</span> delete_list(data) &#123;</span><br><span class="line">		<span class="keyword">await</span> <span class="keyword">this</span>.where(&#123;id:data&#125;).delete();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="common_-_26gt_3B_config_-_26gt_3B_db-js__u4FEE_u6539db__u6587_u4EF6_u4FEE_u6539_uFF0C_u8FDE_u63A5_u6570_u636E_u5E93"><a href="#common_-_26gt_3B_config_-_26gt_3B_db-js__u4FEE_u6539db__u6587_u4EF6_u4FEE_u6539_uFF0C_u8FDE_u63A5_u6570_u636E_u5E93" class="headerlink" title="common -&gt; config -&gt; db.js 修改db  文件修改，连接数据库"></a>common -&gt; config -&gt; db.js 修改db  文件修改，连接数据库</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  type: <span class="string">'mysql'</span>,</span><br><span class="line">  host: <span class="string">''</span>,		<span class="comment">//ip地址</span></span><br><span class="line">  port: <span class="string">'3306'</span>,</span><br><span class="line">  name: <span class="string">'weibo'</span>,		<span class="comment">//名称</span></span><br><span class="line">  user: <span class="string">'root'</span>,</span><br><span class="line">  pwd: <span class="string">''</span>,		<span class="comment">//密码</span></span><br><span class="line">  prefix: <span class="string">'weibo_'</span>,	<span class="comment">//前缀名称</span></span><br><span class="line">  encoding: <span class="string">'utf8'</span>,</span><br><span class="line">  nums_per_page: <span class="number">10</span>,</span><br><span class="line">  log_sql: <span class="literal">true</span>,</span><br><span class="line">  log_connect: <span class="literal">true</span>,</span><br><span class="line">  cache: &#123;</span><br><span class="line">	on: <span class="literal">true</span>,</span><br><span class="line">	type: <span class="string">''</span>,</span><br><span class="line">	timeout: <span class="number">3600</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="u6570_u636E_u5E93_u76F8_u5173_u64CD_u4F5C"><a href="#u6570_u636E_u5E93_u76F8_u5173_u64CD_u4F5C" class="headerlink" title="数据库相关操作"></a>数据库相关操作</h3><ul>
<li>创建和db.js中<code>name</code>字段一样的数据库</li>
<li>增加相关表，表名称的前缀要和db.js中<code>prefix</code>字段相同</li>
<li>设计表<ul>
<li>增加<code>id</code>,int自动递增,主键</li>
<li>增加<code>user_name</code>,varchar</li>
<li>增加<code>text</code>,varchar</li>
<li>增加<code>user_id</code>,int </li>
<li>增加<code>date</code>,varchar</li>
</ul>
</li>
<li>sql语句如下：<ul>
<li><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line">Navicat MySQL Data Transfer</span><br><span class="line"></span><br><span class="line">Source Server         : my_site</span><br><span class="line">Source Server Version : 50628</span><br><span class="line">Source Host           : 123.**.**.***</span><br><span class="line">Source Database       : weibo</span><br><span class="line"></span><br><span class="line">Target Server Type    : MYSQL</span><br><span class="line">Target Server Version : 50628</span><br><span class="line">File Encoding         : 65001</span><br><span class="line"></span><br><span class="line">Date: 2015-12-01 </span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">SET FOREIGN_KEY_CHECKS=0;</span><br><span class="line"></span><br><span class="line">-- ----------------------------</span><br><span class="line">-- Table structure for weibo_list</span><br><span class="line">-- ----------------------------</span><br><span class="line">DROP TABLE IF EXISTS `weibo_list`;</span><br><span class="line">CREATE TABLE `weibo_list` (</span><br><span class="line">  `id` int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  `user_name` varchar(40) NOT NULL,</span><br><span class="line">  `text` varchar(280) NOT NULL,</span><br><span class="line">  `user_id` int(11) NOT NULL,</span><br><span class="line">  `date` varchar(40) DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (`id`)</span><br><span class="line">) ENGINE=InnoDB AUTO_INCREMENT=65 DEFAULT CHARSET=utf8;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h3 id="u542F_u52A8_u9879_u76EE"><a href="#u542F_u52A8_u9879_u76EE" class="headerlink" title="启动项目"></a>启动项目</h3><ul>
<li>package.json同级目录下<code>npm install &amp;&amp; npm start</code></li>
<li>打开浏览器，访问<a href="http://127.0.0.1:8360/" target="_blank" rel="external">http://127.0.0.1:8360/</a></li>
</ul>
<h3 id="u5C55_u793A_u6548_u679C"><a href="#u5C55_u793A_u6548_u679C" class="headerlink" title="展示效果"></a>展示效果</h3><p><img src="https://o3o97s3zl.qnssl.com/20151201_weibo.png" alt="微博"></p>
<h3 id="u5E7F_u64AD_u3001_u5220_u9664_u5FAE_u535A"><a href="#u5E7F_u64AD_u3001_u5220_u9664_u5FAE_u535A" class="headerlink" title="广播、删除微博"></a>广播、删除微博</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*广播消息*/</span></span><br><span class="line">$.ajax(&#123;</span><br><span class="line">	 type: <span class="string">'POST'</span>,</span><br><span class="line">	 url: <span class="string">'home/index/send'</span> ,</span><br><span class="line">	 data: &#123;</span><br><span class="line">		<span class="string">'user_name'</span>: $(<span class="string">'#userName'</span>).val(),</span><br><span class="line">		<span class="string">'user_id'</span>: $(<span class="string">'#face .current'</span>).index() + <span class="number">1</span>,</span><br><span class="line">		<span class="string">'text'</span>: $(<span class="string">'#conBox'</span>).val(),</span><br><span class="line">		 <span class="string">'date'</span>: new_date</span><br><span class="line">	 &#125; ,</span><br><span class="line">	 success: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">		...</span><br><span class="line">	 &#125;</span><br><span class="line">&#125;);	</span><br><span class="line"></span><br><span class="line"><span class="comment">/*删除消息*/</span></span><br><span class="line">$.ajax(&#123;</span><br><span class="line">	 type: <span class="string">'POST'</span>,</span><br><span class="line">	 url: <span class="string">'home/index/delete'</span> ,</span><br><span class="line">	 data: &#123;</span><br><span class="line">		<span class="string">'id'</span>: $(<span class="keyword">this</span>).parents(<span class="string">'li'</span>).attr(<span class="string">'list_id'</span>)</span><br><span class="line">	 &#125; ,</span><br><span class="line">	 success: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">		...</span><br><span class="line">	 &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="REST_API"><a href="#REST_API" class="headerlink" title="REST API"></a>REST API</h3><p>关于REST API,thinkJS 中提供了很便捷的方式，只需要判断请求方式，在控制器中增加对应的方法即可<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">* send action</span><br><span class="line">* 发送消息</span><br><span class="line">* @return &#123;Promise&#125; []</span><br><span class="line">*/</span></span><br><span class="line"><span class="keyword">async</span> sendAction() &#123;</span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">this</span>.isPost())&#123;</span><br><span class="line">	  <span class="keyword">await</span> <span class="keyword">this</span>.model(<span class="string">'list'</span>).addList(<span class="keyword">this</span>.post());</span><br><span class="line">	  <span class="keyword">this</span>.success();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="u603B_u7ED3"><a href="#u603B_u7ED3" class="headerlink" title="总结"></a>总结</h3><p>至此，大工告成，thinkJS开发起来是又快又爽，撸了个<code>微博</code>小练习连20分钟都到不了，当然，以上只是基础，更多好玩的好用的还要持续关注<code>文档</code>，最后再次感谢<code>thinkJS</code>与<code>成银</code>老师，源代码已放到我的<a href="https://github.com/liushaohua/Example/tree/master/thinkjs/demo01" target="_blank" rel="external">github</a>，欢迎大家参考。</p>
<h3 id="u53C2_u8003_u8D44_u6599"><a href="#u53C2_u8003_u8D44_u6599" class="headerlink" title="参考资料"></a>参考资料</h3><ul>
<li><a href="https://thinkjs.org" target="_blank" rel="external">官方文档</a></li>
</ul>
]]></content>
    <summary type="html">
    <![CDATA[<p>玩过<code>Node</code>的同学对<code>Express</code>肯定不陌生，是TJ大神主刀开发的，今天咱们来说<code>下ThinkJS</code>，提到<code>ThinkPHP</code>各位同学肯定秒懂了，感谢<code>奇舞团</code>&amp;&amp;<code>成银老师</code>。</p>]]>
    
    </summary>
    
      <category term="ThinkJS" scheme="http://www.liushaohua.cn/tags/ThinkJS/"/>
    
      <category term="node.js" scheme="http://www.liushaohua.cn/tags/node-js/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[为你的网站升级HTTP/2]]></title>
    <link href="http://www.liushaohua.cn/2015/08/21/%E4%B8%BA%E4%BD%A0%E7%9A%84%E7%BD%91%E7%AB%99%E5%8D%87%E7%BA%A7http-2/"/>
    <id>http://www.liushaohua.cn/2015/08/21/为你的网站升级http-2/</id>
    <published>2015-08-21T07:45:34.000Z</published>
    <updated>2016-02-14T07:45:28.827Z</updated>
    <content type="html"><![CDATA[<p>关于http/2被炒火已经有一段日子了，并且已经有许多站点争相追逐使用，今年5月终于定稿发布了，作为一个不热爱<code>学习</code>的前端狗，已经比那些热爱学习的大神们晚了好久，是时候<code>折腾</code>一下子了，不然<code>老了</code>是真的动不了了。<br>早些年Nginx发布了一个<code>early-alpha patch</code>模块来对HTTP/2进行支持，从1.9.5开始<code>ttpv2module</code> 替换了 <code>ngxhttpspdy_module</code> 正式全面的对HTTP/2支持。<br><a id="more"></a></p>
<h3 id="SSL_u90E8_u7F72"><a href="#SSL_u90E8_u7F72" class="headerlink" title="SSL部署"></a>SSL部署</h3><p>SSL有几款是免费的，生成证书后<code>listen 443</code>即可;</p>
<h3 id="u5B89_u88C5/_u5347_u7EA7Nginx"><a href="#u5B89_u88C5/_u5347_u7EA7Nginx" class="headerlink" title="安装/升级Nginx"></a>安装/升级Nginx</h3><p>如果你服务器的Nginx版本<code>太低</code>，必须要升级下<br>修改<code>/etc/yum.repos.d/nginx.repo</code>的nginx仓库地址<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[nginx]</span><br><span class="line">name=nginx repo  </span><br><span class="line">baseurl=http://nginx.org/packages/mainline/centos/$releasever/$basearch/  </span><br><span class="line">gpgcheck=0  </span><br><span class="line">enabled=1</span><br></pre></td></tr></table></figure></p>
<p>没安装Nginx的话 <code>yum install nginx</code>，已经安装了的话，就可以 <code>yum clean all &amp;&amp; yum update nginx</code>进行升级。</p>
<h3 id="u68C0_u6D4BNginx_u7248_u672C_u81F3_u5C11_u89811-9-5_u4EE5_u4E0A"><a href="#u68C0_u6D4BNginx_u7248_u672C_u81F3_u5C11_u89811-9-5_u4EE5_u4E0A" class="headerlink" title="检测Nginx版本至少要1.9.5以上"></a>检测Nginx版本至少要1.9.5以上</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ nginx -v</span><br><span class="line">nginx version: nginx/<span class="number">1.9</span>.<span class="number">9</span></span><br></pre></td></tr></table></figure>
<h3 id="Nginx_u542F_u52A8"><a href="#Nginx_u542F_u52A8" class="headerlink" title="Nginx启动"></a>Nginx启动</h3><p>只需要修改<code>nginx.conf</code>中的配置<br><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">server</span> &#123;  </span><br><span class="line">  <span class="title">listen</span>        <span class="number">443</span> ssl http2; </span><br><span class="line">  <span class="title">server_name</span>   liushaohua.cn;</span><br><span class="line"></span><br><span class="line">  <span class="comment">#SSL配置</span></span><br><span class="line">  <span class="title">ssl</span>                   <span class="built_in">on</span>;</span><br><span class="line">  <span class="title">ssl_certificate</span>       /etc/nginx/conf.d/certificate.crt;</span><br><span class="line">  <span class="title">ssl_certificate_key</span>   /etc/nginx/conf.d/certificate.key;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><code>listen 443 ssl http2</code></p>
<h3 id="u5F3A_u5236https"><a href="#u5F3A_u5236https" class="headerlink" title="强制https"></a>强制https</h3><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">if</span> (<span class="variable">$server_port</span> = <span class="number">80</span>) &#123;</span><br><span class="line">	<span class="title">rewrite</span><span class="regexp"> ^(.*)$</span> <span class="url">https://<span class="variable">$host</span><span class="variable">$1</span></span> <span class="built_in">permanent</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="u91CD_u542F"><a href="#u91CD_u542F" class="headerlink" title="重启"></a>重启</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/usr/sbin/nginx -s reload</span><br><span class="line">netstat -apnt | grep 443</span><br></pre></td></tr></table></figure>
<p>如果显示为下面这样<br><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">tcp</span>        <span class="number">0</span>      <span class="number">0</span> <span class="number">0.0.0.0:443</span>             <span class="number">0.0.0.0</span>:*               LISTEN      <span class="number">7255</span>/nginx: master</span><br></pre></td></tr></table></figure></p>
<p>访问下你的网站，打开开发者工具，看看<code>Protocol</code>是否返回了h2,返回了的话就ok了~~</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>关于http/2被炒火已经有一段日子了，并且已经有许多站点争相追逐使用，今年5月终于定稿发布了，作为一个不热爱<code>学习</code>的前端狗，已经比那些热爱学习的大神们晚了好久，是时候<code>折腾</code>一下子了，不然<code>老了</code>是真的动不了了。<br>早些年Nginx发布了一个<code>early-alpha patch</code>模块来对HTTP/2进行支持，从1.9.5开始<code>ttpv2module</code> 替换了 <code>ngxhttpspdy_module</code> 正式全面的对HTTP/2支持。<br>]]>
    
    </summary>
    
      <category term="HTTP" scheme="http://www.liushaohua.cn/tags/HTTP/"/>
    
      <category term="Nginx" scheme="http://www.liushaohua.cn/tags/Nginx/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[new一个hexo]]></title>
    <link href="http://www.liushaohua.cn/2015/07/12/new%E4%B8%80%E4%B8%AAhexo/"/>
    <id>http://www.liushaohua.cn/2015/07/12/new一个hexo/</id>
    <published>2015-07-12T01:28:43.000Z</published>
    <updated>2016-02-22T02:09:20.646Z</updated>
    <content type="html"><![CDATA[<p>&emsp;&emsp;时隔多年，我终于又开始用个人网站了，记得当年第一次用的时候是2011年，为了找工作购买了域名<a href="http://www.hinlary.com" target="_blank" rel="external">www.hinlary.com</a>，还购买了廉价服务器,一个月也就10几20几块吧，当时只是放了静态页面上去，后续找到工作后就没有在用过，空间到期了懒得续了，域名到是续过2次就再没续过，随后也是过期了，后来又过了不知多久，闲来无事就注册了现在这个域名，买了个相对便宜的香港主机150一年，就在上面搭了WordPress写过几篇博文过了1年主机到期了又不了了之了，总之就是坚持不下来~14年左右吧看大家用github，我也跟风搞了一发，搭建了个github-page,随意放了点静态页面，也是懒的原因，浑浑噩噩的度过了15年，先后换了几台电脑，由DELL换成了mac，又换回了公司配的DELL，加上自己存放东西毫无规律，这么些年写的代码都找不到了，也是醉的不行了~桑不起的前端狗撒~~~  !</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>&emsp;&emsp;时隔多年，我终于又开始用个人网站了，记得当年第一次用的时候是2011年，为了找工作购买了域名<a href="http://www.hinlary.com" target="_blank" rel="external">www.hinlary.com]]>
    </summary>
    
      <category term="hexo" scheme="http://www.liushaohua.cn/tags/hexo/"/>
    
      <category term="个人随笔" scheme="http://www.liushaohua.cn/tags/%E4%B8%AA%E4%BA%BA%E9%9A%8F%E7%AC%94/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Hello World test]]></title>
    <link href="http://www.liushaohua.cn/2015/07/01/hello-world/"/>
    <id>http://www.liushaohua.cn/2015/07/01/hello-world/</id>
    <published>2015-07-01T06:13:51.000Z</published>
    <updated>2016-01-31T01:21:11.218Z</updated>
    <content type="html"><![CDATA[<p>Welcome to <a href="http://hexo.io/" target="_blank" rel="external">Hexo</a>! This is your very first post. Check <a href="http://hexo.io/docs/" target="_blank" rel="external">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="http://hexo.io/docs/troubleshooting.html" target="_blank" rel="external">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="external">GitHub</a>.</p>
<a id="more"></a>
<h2 id="Quick_Start"><a href="#Quick_Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create_a_new_post"><a href="#Create_a_new_post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>
<p>More info: <a href="http://hexo.io/docs/writing.html" target="_blank" rel="external">Writing</a></p>
<h3 id="Run_server"><a href="#Run_server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>More info: <a href="http://hexo.io/docs/server.html" target="_blank" rel="external">Server</a></p>
<h3 id="Generate_static_files"><a href="#Generate_static_files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>More info: <a href="http://hexo.io/docs/generating.html" target="_blank" rel="external">Generating</a></p>
<h3 id="Deploy_to_remote_sites"><a href="#Deploy_to_remote_sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>More info: <a href="http://hexo.io/docs/deployment.html" target="_blank" rel="external">Deployment</a></p>
]]></content>
    <summary type="html">
    <![CDATA[<p>Welcome to <a href="http://hexo.io/">Hexo</a>! This is your very first post. Check <a href="http://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="http://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>]]>
    
    </summary>
    
  </entry>
  
  <entry>
    <title><![CDATA[centos7下安装mysql]]></title>
    <link href="http://www.liushaohua.cn/2015/04/12/centos7%E4%B8%8B%E5%AE%89%E8%A3%85mysql/"/>
    <id>http://www.liushaohua.cn/2015/04/12/centos7下安装mysql/</id>
    <published>2015-04-12T03:13:45.000Z</published>
    <updated>2016-02-04T05:09:38.197Z</updated>
    <content type="html"><![CDATA[<p>我在我笔记本中安装了<code>mysql</code>，而我的远程服务上还没安装，身为一个小白，要多折腾一下。<br><a id="more"></a><br>由于我服务器的系统是<code>CentOS7</code>，而CentOS7的yum源中貌似没有正常安装mysql时的<code>mysql-sever</code>文件，需要去官网上下载。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget http://dev.mysql.com/get/mysql-community-release-el7-<span class="number">5</span>.noarch.rpm</span><br><span class="line">rpm -ivh mysql-community-release-el7-<span class="number">5</span>.noarch.rpm</span><br><span class="line">yum install mysql-community-server</span><br></pre></td></tr></table></figure>
<h2 id="u8BA9MySQL_u670D_u52A1_u5668_u88AB_u8FDC_u7A0B_u8BBF_u95EE"><a href="#u8BA9MySQL_u670D_u52A1_u5668_u88AB_u8FDC_u7A0B_u8BBF_u95EE" class="headerlink" title="让MySQL服务器被远程访问"></a>让MySQL服务器被远程访问</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">//在本机登入mysql后，更改<span class="string">"mysql"</span>数据库里的<span class="string">"user"</span>表里的<span class="string">"host"</span>项，从<span class="string">"localhost"</span>改为<span class="string">"%"</span>。</span><br><span class="line">mysql&gt;</span><br><span class="line">mysql&gt;use mysql;</span><br><span class="line">mysql&gt;select <span class="string">'host'</span> from user <span class="built_in">where</span> user=<span class="string">'root'</span>;</span><br><span class="line"></span><br><span class="line">//查看mysql库中的user表的host值（即可进行连接访问的主机/IP名称）</span><br><span class="line">mysql&gt;update user <span class="built_in">set</span> host = <span class="string">'%'</span> <span class="built_in">where</span> user =<span class="string">'root'</span>;</span><br><span class="line"></span><br><span class="line">//如果报错：ERROR <span class="number">1062</span> (<span class="number">23000</span>): Duplicate entry <span class="string">'%-root'</span> <span class="keyword">for</span> key <span class="string">'PRIMARY'</span></span><br><span class="line"></span><br><span class="line">select host from user <span class="built_in">where</span> user = <span class="string">'root'</span>;</span><br><span class="line">//查看一下host是否已经有了%这个值</span><br><span class="line"></span><br><span class="line">+--------------+------+</span><br><span class="line">| host         | user |</span><br><span class="line">+--------------+------+</span><br><span class="line">| %            | root |</span><br><span class="line">| <span class="number">127.0</span>.<span class="number">0.1</span>    | root |</span><br><span class="line">| ::<span class="number">1</span>          | root |</span><br><span class="line">| iz25zf7cpbkz | root |</span><br><span class="line">+--------------+------+</span><br><span class="line"></span><br><span class="line">//如果有了直接执行下面的flush privileges;即可</span><br><span class="line">mysql&gt;flush privileges;</span><br><span class="line">mysql&gt;select host,user from user <span class="built_in">where</span> user=<span class="string">'root'</span>;</span><br><span class="line">mysql&gt;quit</span><br></pre></td></tr></table></figure>
<p>然后就可以愉快的去玩耍了</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>我在我笔记本中安装了<code>mysql</code>，而我的远程服务上还没安装，身为一个小白，要多折腾一下。<br>]]>
    
    </summary>
    
      <category term="Linux" scheme="http://www.liushaohua.cn/tags/Linux/"/>
    
      <category term="mysql" scheme="http://www.liushaohua.cn/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[express4.x体验]]></title>
    <link href="http://www.liushaohua.cn/2015/04/02/express4-x%E4%BD%93%E9%AA%8C/"/>
    <id>http://www.liushaohua.cn/2015/04/02/express4-x体验/</id>
    <published>2015-04-02T02:04:36.000Z</published>
    <updated>2016-02-02T02:33:05.394Z</updated>
    <content type="html"><![CDATA[<p>Express 是一个基于 Node.js 平台的极简、灵活的 web 应用开发框架，它提供一系列强大的特性，帮助你创建各种 Web 和移动设备应用。</p>
<a id="more"></a>
<h3 id="u5B89_u88C5"><a href="#u5B89_u88C5" class="headerlink" title="安装"></a>安装</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">npm install -g express</span><br><span class="line">npm install -g express-generator</span><br><span class="line">express myBlog</span><br><span class="line">cd myBlog &amp;&amp; npm install</span><br><span class="line">npm start</span><br></pre></td></tr></table></figure>
<p>npm start 之后就跑起来了，打开浏览器localhost 3000端口 <a href="http://localhost:3000/" target="_blank" rel="external">http://localhost:3000/</a></p>
<ul>
<li><p>常用的express函数</p>
<ul>
<li><code>res.redirect(&#39;/&#39;)</code>; 重定向</li>
<li><code>express -e myblog</code> 创建博客的时候使用ejs 默认为jade</li>
<li><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">router.post(<span class="string">'/reg'</span>,<span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line"> 　　<span class="keyword">var</span> userName = req.body.username;   <span class="comment">//获取post后页面内的name</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>var session = require(&#39;express-session&#39;);</code>     //引入session  </p>
</li>
<li><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用session</span></span><br><span class="line">app.use(session(&#123;</span><br><span class="line">	secret: <span class="string">'myblog'</span>,</span><br><span class="line">	resave: <span class="literal">false</span>,</span><br><span class="line">	saveUninitialized: <span class="literal">false</span></span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>app.use(flash());</code>  //使用flash  </p>
</li>
<li><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">app.use(<span class="function"><span class="keyword">function</span>(<span class="params">req,res,next</span>)</span>&#123;</span><br><span class="line">	res.locals.error = req.flash(<span class="string">'error'</span>).toString() || <span class="string">""</span>;</span><br><span class="line">	res.locals.success = req.flash(<span class="string">'success'</span>).toString() || <span class="string">""</span>;</span><br><span class="line">	res.locals.title = <span class="string">""</span>;</span><br><span class="line">	res.locals.count = <span class="number">0</span>;</span><br><span class="line">	res.locals.pageNum= <span class="number">0</span>;</span><br><span class="line">	res.locals.pageSize= <span class="number">0</span>;</span><br><span class="line">	res.locals.totalPage= <span class="number">0</span>;</span><br><span class="line">	res.locals.keyword=<span class="string">''</span>;</span><br><span class="line">	res.locals.user = req.session.user;</span><br><span class="line">	next();</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//app.locals：这是一个函数对象，可以给它增加新的属性。程序内所有页面模板都能访问这个对象，所以可以用它保存全局配置变量供页面模板使用。</span></span><br><span class="line"><span class="comment">//调用方法</span></span><br><span class="line">&lt;%=title%&gt;</span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="title">%=error%</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>再看下app.js      </p>
<ul>
<li><p>1.app.set(name,value)</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//把名字为name的项的值设为value，用于设置参数</span></span><br><span class="line">app.set(<span class="string">'views'</span>, path.join(__dirname, <span class="string">'views'</span>));</span><br><span class="line"><span class="comment">//设置了模版文件夹的路径；主要清楚__dirname的意思就可以了，它是node.js中的全局变量，表示取当前执行文件的路径</span></span><br><span class="line">app.set(<span class="string">'view engine'</span>, <span class="string">'ejs'</span>);  <span class="comment">//设置使用的模版引擎，我们使用的ejs</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>2.app.use([path], function)</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//用这个方法来使用中间件，因为express依赖于connect，有大量的中间件，可以通过app.use来使用；</span></span><br><span class="line"><span class="comment">//path参数可以不填，默认为'/' (项目中用到的就不分别解释了，用到的时候自已查一API的中间件部分)</span></span><br><span class="line">app.use(express.static(path.join(__dirname, <span class="string">'public'</span>))); </span><br><span class="line"><span class="comment">//这一句中可能要注意一下，express.static( )是处理静态请求的，设置了public文件，</span></span><br><span class="line"><span class="comment">//public下所有文件都会以静态资料文件形式返回（如样式、脚本、图片素材等文件）</span></span><br><span class="line"><span class="keyword">var</span> routes = <span class="built_in">require</span>(<span class="string">'./routes/index'</span>);</span><br><span class="line"><span class="keyword">var</span> users = <span class="built_in">require</span>(<span class="string">'./routes/users'</span>);</span><br><span class="line">app.use(<span class="string">'/'</span>, routes);app.use(<span class="string">'/users'</span>, users);</span><br><span class="line"><span class="comment">//上面代码表示当用户使用/访问时，调用routes，即routes目录下的index.js文件，</span></span><br><span class="line"><span class="comment">//其中.js后缀省略，用/users访问时，调用routes目录下users.js文件</span></span><br><span class="line"><span class="comment">//这就是为什么，我们示例中用http://localhost:8100/访问时候，</span></span><br><span class="line"><span class="comment">//修改的index.js里的文件代码可以执行（当然index.js文件中也要写对应的代码，才能是我们最终看到的效果）</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>3.app.get(name)</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">获取名为name的项的值</span><br><span class="line"><span class="keyword">if</span> (app.get(<span class="string">'env'</span>) === <span class="string">'development'</span>) &#123; </span><br><span class="line">	app.use(<span class="function"><span class="keyword">function</span>(<span class="params">err, req, res, next</span>) </span>&#123; </span><br><span class="line">		res.status(err.status || <span class="number">500</span>); </span><br><span class="line">		res.render(<span class="string">'error'</span>, &#123; message: err.message, error: err &#125;); </span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br><span class="line">　　表示如果是开发环境，处理error时会输出堆栈信息</span><br></pre></td></tr></table></figure>
</li>
<li><p>4.路由文件index.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">主要看下面这段代码</span><br><span class="line">router.get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123; </span><br><span class="line">	res.render(<span class="string">'index'</span>, &#123; </span><br><span class="line">		title: <span class="string">'&lt;h1&gt;Express&lt;/h1&gt;'</span> ,</span><br><span class="line">		users:[</span><br><span class="line">				&#123;username: <span class="string">'Wilson'</span>&#125;,</span><br><span class="line">				&#123;username: <span class="string">'Wilson Zhong'</span>&#125;, </span><br><span class="line">				&#123;username: <span class="string">'Zhong Wei'</span>&#125;</span><br><span class="line">		] </span><br><span class="line">	&#125;);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//这段表示，router.get表示通过get请求/时，响应后面的function处理，两个参数分别是request、response；</span></span><br><span class="line"><span class="comment">//res.render表示调用模版引擎解析名字index的模板，传并传入了title和users两个对象做为参数；</span></span><br><span class="line"><span class="comment">//为什么它会知道解板views目录下的index.ejs?而不是其它目录下的文件，或者后其它后缀名的文件？</span></span><br><span class="line"><span class="comment">//原因就是app.js中的设置：</span></span><br><span class="line">app.set(<span class="string">'views'</span>, path.join(__dirname, <span class="string">'views'</span>));</span><br><span class="line">app.set(<span class="string">'view engine'</span>, <span class="string">'ejs'</span>);</span><br><span class="line"><span class="comment">//而这两个参数在index.ejs中可以使用，那么加上ejs的部分，就会返回最终生成的页面展现！</span></span><br><span class="line"><span class="comment">//res.send("req.host获取主机名，req.path获取请求路径名!");</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>5.获取url参数 </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">url：http:<span class="comment">//localhost:8888/select?name=a&amp;id=5</span></span><br><span class="line">http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">request,response</span>)</span>&#123; </span><br><span class="line">	<span class="keyword">var</span> pathname = url.parse(request.url).pathname;  <span class="comment">//pathname =&gt; select </span></span><br><span class="line">	   </span><br><span class="line">	<span class="keyword">var</span> arg = url.parse(request.url).query;          <span class="comment">//arg =&gt; name=a&amp;id=5 </span></span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">"Request for "</span> + arg ); </span><br><span class="line">	<span class="keyword">var</span> str = querystring.parse(arg);                <span class="comment">//str=&gt; &#123;name:'a',id:'5'&#125; </span></span><br><span class="line">	   </span><br><span class="line">	<span class="keyword">var</span> arg1 = url.parse(request.url, <span class="literal">true</span>).query;   <span class="comment">//arg1 =&gt; &#123;name:'a',id:'5'&#125; </span></span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">"Request for "</span> + arg1 ); </span><br><span class="line">	   </span><br><span class="line">	<span class="keyword">var</span> name = querystring.parse(arg).name;         <span class="comment">//name =&gt; a </span></span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">"name = "</span>+name); </span><br><span class="line"></span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">"Request for "</span> + pathname + <span class="string">" received."</span>); </span><br><span class="line">&#125;).listen(<span class="number">8888</span>);</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
]]></content>
    <summary type="html">
    <![CDATA[<p>Express 是一个基于 Node.js 平台的极简、灵活的 web 应用开发框架，它提供一系列强大的特性，帮助你创建各种 Web 和移动设备应用。</p>]]>
    
    </summary>
    
      <category term="express" scheme="http://www.liushaohua.cn/tags/express/"/>
    
      <category term="node.js" scheme="http://www.liushaohua.cn/tags/node-js/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Node学习笔记-Tcp]]></title>
    <link href="http://www.liushaohua.cn/2014/04/12/node-tcp/"/>
    <id>http://www.liushaohua.cn/2014/04/12/node-tcp/</id>
    <published>2014-04-12T07:37:23.000Z</published>
    <updated>2016-03-14T10:52:28.408Z</updated>
    <content type="html"><![CDATA[<h3 id="u524D_u8A00"><a href="#u524D_u8A00" class="headerlink" title="前言"></a>前言</h3><p>在浏览器中通过http仅能实现单向的通信，但如果想做实时通讯，我们应该怎么搞？大家的脑海里的第一印象是不是<code>WebSocket</code>or <code>Socket.io</code>，区别于 HTTP 服务器以 HTTP 为通讯协议， 实时服务器一般采用较为底层的 TCP/IP 为协议通讯，实现了“套字节 Socket”的双向机制，接下来咱们就具体实践下。<br><a id="more"></a></p>
<h3 id="u5173_u4E8ETCP"><a href="#u5173_u4E8ETCP" class="headerlink" title="关于TCP"></a>关于TCP</h3><ul>
<li><code>TPC/IP</code>协议是传输层协议，主要解决数据如何在网络中传输</li>
<li>TCP分层模型<ul>
<li>应用层</li>
<li>表示层</li>
<li>会话层</li>
<li>传输层</li>
<li>网络层</li>
<li>数据链路层</li>
<li>物理层</li>
</ul>
</li>
<li>让数据进行计算机间传输</li>
<li>传输前要经过三次握手 才能发射数据</li>
<li>当会话过程中，双方都提供一个套接字 socket. 实现客户端和服务器端的连接</li>
<li>socket可读可写的一个流</li>
</ul>
<h3 id="u5B83_u80FD_u505A_u4EC0_u4E48"><a href="#u5B83_u80FD_u505A_u4EC0_u4E48" class="headerlink" title="它能做什么"></a>它能做什么</h3><p>Nodejs提供了<code>net</code>模块给我们，可用于创建Socket服务器或Socket客户端。NodeJS 的数据通信，最基础的两个模块是 Net 和 Http，前者是基于 Tcp 的封装，后者本质还是 Tcp 层，只不过做了比较多的数据封装，我们视为表现层</p>
<h3 id="u5EFA_u7ACB_u4E00_u4E2ATcp_u670D_u52A1_u5668"><a href="#u5EFA_u7ACB_u4E00_u4E2ATcp_u670D_u52A1_u5668" class="headerlink" title="建立一个Tcp服务器"></a>建立一个<code>Tcp</code>服务器</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span>  net = <span class="built_in">require</span>(<span class="string">'net'</span>),</span><br><span class="line">     fs = <span class="built_in">require</span>(<span class="string">'fs'</span>),</span><br><span class="line">     ws = fs.createWriteStream(<span class="string">'tcp.log'</span>);</span><br><span class="line"><span class="keyword">var</span>  server = net.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">socket</span>)</span>&#123;</span><br><span class="line">     <span class="built_in">console</span>.log(socket.address());</span><br><span class="line">     socket.setEncoding(<span class="string">'utf8'</span>);</span><br><span class="line">	</span><br><span class="line">  	 server.on(<span class="string">'listening'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	   <span class="built_in">console</span>.log(<span class="string">'Server is listening on port'</span>);</span><br><span class="line">	 &#125;);</span><br><span class="line">	</span><br><span class="line">     socket.on(<span class="string">'data'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">chunk</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(chunk);</span><br><span class="line">        ws.write(chunk);</span><br><span class="line">     &#125;);</span><br><span class="line">	</span><br><span class="line">     socket.on(<span class="string">'end'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'end'</span>);</span><br><span class="line">     &#125;);</span><br><span class="line"></span><br><span class="line">     socket.on(<span class="string">'close'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'close'</span>);</span><br><span class="line">        socket.destroy();</span><br><span class="line">     &#125;);</span><br><span class="line">&#125;);</span><br><span class="line">server.listen(<span class="number">8080</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'started'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="u8BBF_u95EE_u670D_u52A1_u5668"><a href="#u8BBF_u95EE_u670D_u52A1_u5668" class="headerlink" title="访问服务器"></a>访问服务器</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">telnet 127.0.0.1 8080</span><br></pre></td></tr></table></figure>
<p>建立连接后，得到一个socket对象作为回调中的参数，我们可以操作这个socket对象，前面提到过tcp连接的对象是可读可写的流。作为一个流对象，因此能够监听data,end等事件；作为一个可写流，具有write()方法。</p>
<h3 id="u521B_u5EFA_u4E00_u4E2A_u7B80_u5355_u804A_u5929_u670D_u52A1_u5668"><a href="#u521B_u5EFA_u4E00_u4E2A_u7B80_u5355_u804A_u5929_u670D_u52A1_u5668" class="headerlink" title="创建一个简单聊天服务器"></a>创建一个简单聊天服务器</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> net = <span class="built_in">require</span>(<span class="string">'net'</span>),</span><br><span class="line">	clients = &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> server = net.createServer(<span class="function"><span class="keyword">function</span> (<span class="params">socket</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">var</span> name;</span><br><span class="line">	socket.write(<span class="string">'欢迎来到聊天室，请设置昵称:'</span>);</span><br><span class="line">	</span><br><span class="line">	socket.on(<span class="string">'data'</span>,<span class="function"><span class="keyword">function</span> (<span class="params">chunk</span>) </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (name) &#123;</span><br><span class="line">			sendMsg(name.toString() + chunk.toString());</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">if</span> (clients[chunk]) &#123;</span><br><span class="line">				socket.write(<span class="string">'用户名被占用，请更换用户名'</span>);</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				name = chunk;</span><br><span class="line">				clients[chunk] = socket;</span><br><span class="line">				sendMsg(<span class="string">'SYSTEM:'</span>+chunk+<span class="string">'来到聊天室，我们欢迎他'</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;);</span><br><span class="line">	</span><br><span class="line">	socket.on(<span class="string">'close'</span>,<span class="function"><span class="keyword">function</span> (<span class="params">chunk</span>) </span>&#123;</span><br><span class="line">		<span class="keyword">delete</span> clients[name];</span><br><span class="line">		socket.destroy();</span><br><span class="line">		sendMsg(<span class="string">'SYSTEM:'</span>+name+<span class="string">'离开了'</span>);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;).listen(<span class="number">8080</span>);	</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sendMsg</span>(<span class="params">msg</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">var</span> e <span class="keyword">in</span> clients) &#123;</span><br><span class="line">		clients[e].write(msg);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>短短几行代码就搞定了，看上去也比较简单，<code>data</code>的时候判断有没有用户名，有的话并且没有重复就输出，把<code>socket</code>对象缓存并广播所有人，当然只是入门的简版，还需要增加判断是不是本人以及<code>error</code>和<code>close</code>相关，大家可以自行补充哈~~</p>
]]></content>
    <summary type="html">
    <![CDATA[<h3 id="u524D_u8A00"><a href="#u524D_u8A00" class="headerlink" title="前言"></a>前言</h3><p>在浏览器中通过http仅能实现单向的通信，但如果想做实时通讯，我们应该怎么搞？大家的脑海里的第一印象是不是<code>WebSocket</code>or <code>Socket.io</code>，区别于 HTTP 服务器以 HTTP 为通讯协议， 实时服务器一般采用较为底层的 TCP/IP 为协议通讯，实现了“套字节 Socket”的双向机制，接下来咱们就具体实践下。<br>]]>
    
    </summary>
    
      <category term="Tcp" scheme="http://www.liushaohua.cn/tags/Tcp/"/>
    
      <category term="node.js" scheme="http://www.liushaohua.cn/tags/node-js/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Node学习笔记-Stream]]></title>
    <link href="http://www.liushaohua.cn/2014/04/11/node-stream/"/>
    <id>http://www.liushaohua.cn/2014/04/11/node-stream/</id>
    <published>2014-04-11T01:55:25.000Z</published>
    <updated>2016-02-22T07:24:23.294Z</updated>
    <content type="html"><![CDATA[<p>在Node的使用中，我们会频繁的接触到<code>Stream</code>,并且内建stream模块已经被多个Node核心模块使用，同时也可以被用户自定义的模块使用。<code>Stream</code>到底是什么，用来做什么，最近查阅了写资料并进行了整理，简单总结下供自己查阅。</p>
<a id="more"></a>
<h3 id="u7B80_u4ECB"><a href="#u7B80_u4ECB" class="headerlink" title="简介"></a>简介</h3><p><a href="http://nodeapi.ucdok.com/#/api/stream.html" target="_blank" rel="external">官方文档</a>上是这么说的：<code>流是一个抽象接口，被 Node 中的很多对象所实现。比如对一个 HTTP 服务器的请求是一个流，stdout 也是一个流。流是可读、可写或兼具两者的。所有流都是 EventEmitter 的实例。</code> 流又包括四类流， <code>Readable</code> 流、<code>Writable</code> 流、<code>Duplex</code> 流和<code>Transform</code>流，具体的异同会在下文中说到.</p>
<h3 id="u6D41_u7684_u7528_u9014"><a href="#u6D41_u7684_u7528_u9014" class="headerlink" title="流的用途"></a>流的用途</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>),</span><br><span class="line">    fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"> </span><br><span class="line"><span class="keyword">let</span> server = http.createServer(<span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    fs.readFile(__dirname + <span class="string">'/data.txt'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">        res.end(data);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line">server.listen(<span class="number">8000</span>);</span><br></pre></td></tr></table></figure>
<p>上面代码没什么问题,每次请求我们都会把整个data.txt文件读入到内存中，然后把结果返回客户端，但是通常大文件的一次读取和大量用户的高并发都会占用很大的内存，而<code>流</code>则可以分段读取，方便粗暴，大大的方便了我们。</p>
<h3 id="u5982_u4F55_u4F7F_u7528"><a href="#u5982_u4F55_u4F7F_u7528" class="headerlink" title="如何使用"></a>如何使用</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> * 流的分类</span><br><span class="line"> * 可读流 可以从中流出字节内容</span><br><span class="line"> * 可写流 可以把字节写入流中</span><br><span class="line"> * 继承 Readable</span><br><span class="line"> * 继承 EventEmitter</span><br><span class="line"> * @type &#123;exports|module.exports&#125;</span><br><span class="line"> **/</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">//Readable</span></span><br><span class="line"><span class="keyword">let</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>),</span><br><span class="line">    rs = fs.createReadStream(<span class="string">'data.txt'</span>);</span><br><span class="line">	</span><br><span class="line">rs.on(<span class="string">'open'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'打开文件'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//只有当监听了data事件之后才开始真正读取，不监听的话下面的其他方法`end`,'close','error'自然也不会触发</span></span><br><span class="line">rs.on(<span class="string">'data'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">    <span class="comment">//console.log('操作');</span></span><br><span class="line">    rs.pause();<span class="comment">//等待操作完成          暂停流的发射事件 关掉开关</span></span><br><span class="line">    setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'操作完成'</span>);</span><br><span class="line">        rs.resume();<span class="comment">//再次执行操作     重新开始恢复 读取 打开开关</span></span><br><span class="line">    &#125;,<span class="number">1000</span>);</span><br><span class="line">&#125;);</span><br><span class="line">rs.on(<span class="string">'end'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'文件内容读取完毕'</span>);</span><br><span class="line">&#125;);</span><br><span class="line">rs.on(<span class="string">'close'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'文件关闭'</span>);</span><br><span class="line">&#125;);</span><br><span class="line">rs.on(<span class="string">'error'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="u5927_u5BB6_u53EF_u4EE5_u770B_u51FA_u6765_uFF0CReadable_u6D41_u6709_u4EE5_u4E0B_u51E0_u4E2A_u4E8B_u4EF6_uFF1A"><a href="#u5927_u5BB6_u53EF_u4EE5_u770B_u51FA_u6765_uFF0CReadable_u6D41_u6709_u4EE5_u4E0B_u51E0_u4E2A_u4E8B_u4EF6_uFF1A" class="headerlink" title="大家可以看出来，Readable流有以下几个事件："></a>大家可以看出来，<code>Readable</code>流有以下几个事件：</h3><ul>
<li>当一个数据块可以从流中被读出时，它会触发一个 <code>readable</code> 事件</li>
<li><code>data</code>事件 - 数据正在传递时，触发该事件（以chunk数据块为对象）</li>
<li><code>end</code>事件 - 数据传递完成后，会触发该事件。</li>
<li><code>close</code>事件 - 当底层数据源（比如，源头的文件描述符）被关闭时触发。并不是所有流都会触发这个事件。</li>
<li><code>error</code>事件 - 数据接收异常时，会触发该事件</li>
</ul>
<h3 id="u65B9_u4FBF_u7684API"><a href="#u65B9_u4FBF_u7684API" class="headerlink" title="方便的API"></a>方便的API</h3><p>Node还给我提供了简洁的API，供我们使用，而且<code>req</code>,<code>res</code>参数都是流对象,读文件的代码我们就可以调整下:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"> </span><br><span class="line"><span class="keyword">var</span> server = http.createServer(<span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> stream = fs.createReadStream(__dirname + <span class="string">'/data.txt'</span>);</span><br><span class="line">    stream.pipe(res);</span><br><span class="line">&#125;);</span><br><span class="line">server.listen(<span class="number">8000</span>);</span><br></pre></td></tr></table></figure></p>
<p><code>.pipe</code>方法会自动帮助我们监听data和end事件。上面的这段代码不仅简洁，而且<code>data.txt</code>文件中每一小段数据都将源源不断的发送到客户端。<br>除此之外，使用<code>.pipe()</code>方法还有别的好处，比如说它可以自动控制后端压力，以便在客户端连接缓慢的时候node可以将尽可能少的缓存放到内存中。</p>
<h3 id="pipe"><a href="#pipe" class="headerlink" title="pipe"></a>pipe</h3><p>readable.pipe(destination, [options])</p>
<ul>
<li>实现流的输入和输出功能</li>
<li>destination {Writable Stream} 写入数据的目标</li>
<li>options {Object} 导流选项</li>
<li>end {Boolean} 在读取者结束时结束写入者。缺省为 true</li>
</ul>
<h3 id="Stream_u4E2D_u76844_u5927_u5929_u738B"><a href="#Stream_u4E2D_u76844_u5927_u5929_u738B" class="headerlink" title="Stream中的4大天王"></a>Stream中的4大<code>天王</code></h3><table>
<thead>
<tr>
<th>类</th>
<th style="text-align:center">使用场景</th>
<th style="text-align:right">实现的方法</th>
</tr>
</thead>
<tbody>
<tr>
<td>Readable</td>
<td style="text-align:center">只读</td>
<td style="text-align:right">_read</td>
</tr>
<tr>
<td>Writable</td>
<td style="text-align:center">只写</td>
<td style="text-align:right">_write</td>
</tr>
<tr>
<td>Duplex</td>
<td style="text-align:center">读写</td>
<td style="text-align:right">_read,_write</td>
</tr>
<tr>
<td>Transform</td>
<td style="text-align:center">操作被写入的数据，然后读出结果</td>
<td style="text-align:right">_transform,flush</td>
</tr>
</tbody>
</table>
<ul>
<li><p>Readable流（可读流）介绍</p>
<ul>
<li>Readable（可读）流接口是对您正在读取的数据的来源的抽象。换言之，数据出自一个可读流。</li>
<li>Readable 流有两种“模式”：流动模式和暂停模式。</li>
<li>当处于流动模式时，数据由底层系统读出，并尽可能快地提供给您的程序；当处于暂停模式时，您必须明确地调用 stream.read() 来取出若干数据块。流默认处于暂停模式。</li>
<li>Readable流拥有的事件，已经在<code>本文的开始</code>介绍过了。</li>
</ul>
</li>
<li><p>Writable流（可写流）介绍    </p>
<ul>
<li>Writable（可写）流接口是对写入数据的目标的抽象。</li>
<li><code>write()</code>方法 该方法向底层系统写入数据，并在数据被处理完毕后调用所给的回调。</li>
<li><code>end()</code>方法 当不再写入数据时，调用该方法，停止写入。</li>
</ul>
</li>
<li><p>Duplex(双工流) 介绍</p>
<ul>
<li>Duplex（可读写）流同时兼具可读和可写特性，比如一个 TCP 嵌套字连接。</li>
<li>值得注意的是，stream.Duplex 是一个可以像 Readable 或 Writable 一样被扩充、实现了底层方法 _read(sise) 和 _write(chunk, encoding, callback) 的抽象类</li>
</ul>
</li>
<li><p>Transform（转换流）介绍</p>
<ul>
<li>“转换”（transform）流实际上是一个输出与输入存在因果关系的双工流，比如 zlib 流或 crypto 流。</li>
<li>输入和输出并无要求相同大小、相同块数或同时到达。举个例子，一个 Hash 流只会在输入结束时产生一个数据块的输出；一个 zlib 流会产生比输入小得多或大得多的输出。</li>
</ul>
</li>
</ul>
<h3 id="u53C2_u8003_u8D44_u6599"><a href="#u53C2_u8003_u8D44_u6599" class="headerlink" title="参考资料"></a>参考资料</h3><ul>
<li><a href="http://nodeapi.ucdok.com/api/" target="_blank" rel="external">NodeAPI</a></li>
</ul>
]]></content>
    <summary type="html">
    <![CDATA[<p>在Node的使用中，我们会频繁的接触到<code>Stream</code>,并且内建stream模块已经被多个Node核心模块使用，同时也可以被用户自定义的模块使用。<code>Stream</code>到底是什么，用来做什么，最近查阅了写资料并进行了整理，简单总结下供自己查阅。</p>]]>
    
    </summary>
    
      <category term="Stream" scheme="http://www.liushaohua.cn/tags/Stream/"/>
    
      <category term="node.js" scheme="http://www.liushaohua.cn/tags/node-js/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Node学习笔记-Path]]></title>
    <link href="http://www.liushaohua.cn/2014/04/10/node-path/"/>
    <id>http://www.liushaohua.cn/2014/04/10/node-path/</id>
    <published>2014-04-10T06:39:21.000Z</published>
    <updated>2016-02-29T10:07:28.147Z</updated>
    <content type="html"><![CDATA[<p>用过<code>世界上最好的语言</code>的同学一定对<code>pathinfo()</code>这个函数比较熟悉，它是检查文件路径相关的<code>API</code>，说起<code>PHP</code>的内置函数，据说有500多个，也是多的<code>不要不要</code>的了，但是功能强大，极大的增加了我们的开发便利，但我们今天的主题不是<code>PHP</code>，我们来聊下<code>Node</code>的<code>Path</code>。<br><a id="more"></a></p>
<h3 id="u8DEF_u5F84__28Path_29"><a href="#u8DEF_u5F84__28Path_29" class="headerlink" title="路径 (Path)"></a>路径 (Path)</h3><ul>
<li>path.normalize(p)</li>
<li>path.join([path1], [path2], […])</li>
<li>path.resolve([from …], to)</li>
<li>path.isAbsolute(path)</li>
<li>path.relative(from, to)</li>
<li>path.dirname(p)</li>
<li>path.basename(p, [ext])</li>
<li>path.extname(p)</li>
<li>path.sep</li>
<li>path.delimiter</li>
</ul>
<p><code>Path</code>是<code>Node</code>中内置的路径处理模块，通过 require(‘path’) 来加载此模块，我们逐一介绍下各个方法的用途。</p>
<h3 id="path-normalize_28p_29"><a href="#path-normalize_28p_29" class="headerlink" title="path.normalize(p)"></a>path.normalize(p)</h3><ul>
<li>normalize(正常)，将非标准路径转化为标准路径</li>
<li>解析 . <code>当前目录</code> .. <code>上级目录</code> </li>
<li>多个杠转成一个杠</li>
<li>兼容多平台 windows linux<code>\ /</code></li>
<li>如果是斜杠结尾，则保留<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">path.normalize(<span class="string">'./../a////b//d//../c//e//'</span>)</span><br><span class="line">..\a\b\c\e\</span><br><span class="line"></span><br><span class="line">path.normalize(<span class="string">'/foo/bar//baz/asdf/quux/..'</span>)</span><br><span class="line"><span class="string">'/foo/bar/baz/asdf'</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="path-join_28_5Bpath1_5D_2C__5Bpath2_5D_2C__5B_u2026_5D_29"><a href="#path-join_28_5Bpath1_5D_2C__5Bpath2_5D_2C__5B_u2026_5D_29" class="headerlink" title="path.join([path1], [path2], […])"></a>path.join([path1], [path2], […])</h3><ul>
<li>连接所有参数, 并且规范化得到的路径<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">path.join(__dirname,<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'..'</span>,<span class="string">'c'</span>)</span><br><span class="line">E:\node\lectures\<span class="number">10.</span>path\a\c</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="path-resolve_28_5Bfrom__u2026_5D_2C_to_29"><a href="#path-resolve_28_5Bfrom__u2026_5D_2C_to_29" class="headerlink" title="path.resolve([from …], to)"></a>path.resolve([from …], to)</h3><ul>
<li>以应用程序根目录为起点，根据参数的值解析出一个绝对路径</li>
<li>以应用程序根目录为起点</li>
<li>普通字符串代表当前目录的下一级目录</li>
<li>/代表盘符根目录</li>
<li>没有下一个参数，返回当前路径</li>
<li>另一种思路, 是把它看做一系列 cd 命令<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">path.resolve(<span class="string">'/a'</span>,<span class="string">'..'</span>,<span class="string">'b'</span>,<span class="string">'msg'</span>,<span class="string">'a.txt'</span>)</span><br><span class="line">e:\b\msg</span><br></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">path.resolve(&#39;/a&#39;,&#39;..&#39;,&#39;b&#39;,&#39;msg&#39;,&#39;a.txt&#39;)&#10;cd /a &#10;cd ..&#10;cd b/&#10;cd msg&#10;pwd /b/msg</span><br></pre></td></tr></table></figure>
<h3 id="path-isAbsolute_28path_29"><a href="#path-isAbsolute_28path_29" class="headerlink" title="path.isAbsolute(path)"></a>path.isAbsolute(path)</h3><ul>
<li>判断是否绝对路径<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">path.isAbsolute(<span class="string">'/foo/bar'</span>)  <span class="comment">// true</span></span><br><span class="line">path.isAbsolute(<span class="string">'/opt/..'</span>)   <span class="comment">// true</span></span><br><span class="line">   path.isAbsolute(<span class="string">'web/'</span>);     <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="path-relative_28from_2C_to_29"><a href="#path-relative_28from_2C_to_29" class="headerlink" title="path.relative(from, to)"></a>path.relative(from, to)</h3><ul>
<li>解析从from到to的相对路径</li>
<li>返回的是在第一个路径里，如何用相对路径 去引用第二个路径<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">- a</span><br><span class="line">	index.js</span><br><span class="line">- b</span><br><span class="line">	c.js</span><br><span class="line">	</span><br><span class="line">path.relative(<span class="string">'a'</span>,<span class="string">'b/c.js'</span>)</span><br><span class="line">b/c.js</span><br><span class="line"></span><br><span class="line">path.relative(<span class="string">'/data/orandea/test/aaa'</span>, <span class="string">'/data/orandea/impl/bbb'</span>)</span><br><span class="line">   ../../impl/bbb<span class="string">'</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="path-dirname_28p_29"><a href="#path-dirname_28p_29" class="headerlink" title="path.dirname(p)"></a>path.dirname(p)</h3><ul>
<li>获取路径所属的目录</li>
<li>目录的话 返回上一级目录</li>
<li>如果是文件 返回此文件所属的目录<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">path.dirname(__dirname)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="path-basename_28p_2C__5Bext_5D_29"><a href="#path-basename_28p_2C__5Bext_5D_29" class="headerlink" title="path.basename(p, [ext])"></a>path.basename(p, [ext])</h1><ul>
<li>返回指定的文件名，返回结果可排除[ext]后缀字符串<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">'文件名带后缀：'</span>+path.basename(p));</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'文件名不带后缀：'</span>+path.basename(p, <span class="string">'.html'</span>));</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="path-extname_28p_29"><a href="#path-extname_28p_29" class="headerlink" title="path.extname(p)"></a>path.extname(p)</h3><ul>
<li>获取文件的扩展名<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">path.extname(<span class="string">'a/b/index.js'</span>)</span><br><span class="line"><span class="comment">//.js</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="path-sep"><a href="#path-sep" class="headerlink" title="path.sep"></a>path.sep</h2><ul>
<li>路径分隔符<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(path.sep); <span class="comment">// '/'或'\’</span></span><br><span class="line"><span class="built_in">console</span>.log(path_str.split(path.sep)); <span class="comment">// [ '', 'home', 'lee', 'works', 'nodejs', 'study12', 'index.html' ]</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="path-delimiter"><a href="#path-delimiter" class="headerlink" title="path.delimiter"></a>path.delimiter</h2><ul>
<li>环境变量分隔符<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(path.delimiter); <span class="comment">//一般linux是'：'，windows是';'</span></span><br><span class="line"><span class="built_in">console</span>.log(process.env.PATH); <span class="comment">//打印环境变量path</span></span><br><span class="line"><span class="built_in">console</span>.log(process.env.PATH.split(path.delimiter)) <span class="comment">//用path.delimiter分割</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
]]></content>
    <summary type="html">
    <![CDATA[<p>用过<code>世界上最好的语言</code>的同学一定对<code>pathinfo()</code>这个函数比较熟悉，它是检查文件路径相关的<code>API</code>，说起<code>PHP</code>的内置函数，据说有500多个，也是多的<code>不要不要</code>的了，但是功能强大，极大的增加了我们的开发便利，但我们今天的主题不是<code>PHP</code>，我们来聊下<code>Node</code>的<code>Path</code>。<br>]]>
    
    </summary>
    
      <category term="Path" scheme="http://www.liushaohua.cn/tags/Path/"/>
    
      <category term="node.js" scheme="http://www.liushaohua.cn/tags/node-js/"/>
    
  </entry>
  
</feed>
